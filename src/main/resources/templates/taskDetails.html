<!DOCTYPE html>
<html lang="en" xmlns:th="http://www.thymeleaf.org">
<head>
  <meta charset="UTF-8">
  <title th:text="'Task | ' + ${currentTask.title}">Task Details</title>
  <meta name="viewport" content="width=device-width, initial-scale=1">

  <!-- Bootstrap CSS -->
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet">
  <link href="https://cdn.jsdelivr.net/npm/bootstrap-icons/font/bootstrap-icons.css" rel="stylesheet">
  <link href="/css/sidebar.css" rel="stylesheet">
</head>
<body>

<!-- Navbar -->
<div th:replace="~{fragments/commonNavbar}"></div>

<div class="container-fluid">
  <div class="row">

    <!-- Sidebar -->
    <div th:replace="~{fragments/commonSidebar}"></div>

    <!-- Main Content -->
    <main class="col-lg-10 ms-auto p-4" style="background:#f0f2f5; min-height:100vh;">

      <!-- PROJECT INFO -->
      <div class="mb-4">
        <h2 class="text-primary fw-bold" th:text="${project.name}">Project Name</h2>
        <p class="text-muted">Task Details</p>
      </div>

      <!-- CURRENT TASK DETAILS -->
      <div class="card mb-4">
        <div class="card-header bg-dark text-white">
          Current Task
        </div>
        <div class="card-body p-0">
          <table class="table table-bordered mb-0">
            <tr>
              <th>Title</th>
              <td th:text="${currentTask.title}"></td>
            </tr>
            <tr>
              <th>Type</th>
              <td th:text="${currentTask.taskType}"></td>
            </tr>
            <tr>
              <th>Status</th>
              <td th:text="${currentTask.status}"></td>
            </tr>
            <tr>
              <th>Assignee</th>
              <td th:text="${currentTask.assignee != null 
                  ? currentTask.assignee.firstName + ' ' + currentTask.assignee.lastName 
                  : 'Unassigned'}">
              </td>
            </tr>
            <tr th:if="${currentTask.parentTask != null}">
              <th>Parent Task</th>
              <td th:text="${currentTask.parentTask.title}"></td>
            </tr>
            <tr>
              <th>Due Date</th>
              <td th:text="${currentTask.dueDate}"></td>
            </tr>
          </table>
        </div>
      </div>

      <!-- CHILD TASKS -->
      <div th:if="${childTasks != null && !childTasks.isEmpty()}">
        <div class="card">
          <div class="card-header bg-secondary text-white">
            Sub Tasks
          </div>
          <div class="card-body p-0">
            <table class="table table-hover table-bordered mb-0">
              <thead class="table-light">
                <tr>
                  <th>#</th>
                  <th>Title</th>
                  <th>Assignee</th>
                  <th>Status</th>
                  <th>Due Date</th>
                </tr>
              </thead>
              <tbody>
                <tr th:each="task : ${childTasks}">
                  <td th:text="${task.id}"></td>
                  <td>
                    <a th:href="@{/projects/{projectId}/tasks/details/{taskId}(
                          projectId=${project.id}, taskId=${task.id})}"
                       th:text="${task.title}">
                    </a>
                  </td>
                  <td th:text="${task.assignee != null 
                        ? task.assignee.firstName + ' ' + task.assignee.lastName 
                        : 'Unassigned'}">
                  </td>
                  <td th:text="${task.status}"></td>
                  <td th:text="${task.dueDate}"></td>
                </tr>
              </tbody>
            </table>
          </div>
        </div>
      </div>

      <!-- CREATE SUB-TASK BUTTON -->
      <div class="mt-4" th:if="${currentTask.taskType != 'SUB_TASK'}">
        <a class="btn btn-primary"
           th:href="@{/projects/{projectId}/tasks/createSubTask(
             projectId=${project.id}, parentId=${currentTask.id})}">
          + Create Sub-task
        </a>
      </div>

    </main>
  </div>
</div>

<!-- Bootstrap JS -->
<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/js/bootstrap.bundle.min.js"></script>
<script src="/js/sidebar.js"></script>

</body>
</html>
